<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Aidan's Blog</title>
        <meta charset="UTF-8">
        <link rel="stylesheet" href="style.css">
    </head>

    <!-- <body onload="loadPosts();" -->
    <!-- <body onload="loadTestPost();" -->
    <body onload="loadPosts();">


        <h1 id="siteID">Posts</h1>
        <div id="feed">
            <p>Blog posts should appear here.</p>
        </div>
        <br>
    
    </body>

    <footer>
        <hr>
        <small> <p>&copy; Aidan Carr January 6, 2023</p> </small>
    </footer>


    <script>
                
        function loadPosts(){
            htmlString = "";

            (async () => {

                //get data from json file
                //must read from website (annoying)
                const response = await fetch("https://aidancarr1.github.io/Blog/dataNEW.json");
                const data = await response.json();
                
                let posts = Object.keys(data["posts"]);
                let images = Object.keys(data["images"]);

                //go through every post
                for(const i in posts){
                    
                    //json post data
                    thisPost = posts[i];
                    thisDate = data["posts"][thisPost].date;
                    thisTitle = data["posts"][thisPost].title;
                    //thisContent = data["posts"][thisPost].content;
                    
                    //create postBox div
                    //htmlString += "<div class='postBox' onclick='openPage("+'"'+thisPost+'"'+")'>";
                    htmlString += "<div class='postBox'>";
                    
                    //title and date
                    htmlString += "<h2 class='title'>" + thisTitle + "</h2>";
                    htmlString += "<h3 class='date'>" + thisDate +"</h3>";

                    //begin content
                    htmlString += "<div class='content'>";

                    let contents = Object.keys(data["posts"][thisPost]["content"]);
                    
                    //check all contents and images
                    for(const j in contents){
                        
                        let thisThing = contents[j];
                        let thisMeat = data["posts"][thisPost]["content"][thisThing];

                        //alert(thisThing);
                        
                        //determine type
                        thisType = thisThing.substring(0,2);

                        //if type is content, put in a <p>
                        if(thisType === "te"){

                            //htmlString += "<p>p</p>"; //test line
                            htmlString += "<p>" + thisMeat + "</p>";

                        }

                        //if type is an image
                        else if(thisType === "im"){
                            htmlString += "<p>img</p>";
                            //htmlString += "<p>" + thisMeat + "</p>";
                        }
                        
                    }
                    htmlString += "</div>";
                    
                    /*check all images
                    for(const j in entry){

                        thisImage = images[j];
                        thisImagePostID = data["images"][thisImage].postID;

                        //if this image is related to this post...
                        if (thisImagePostID == thisPost){
                            thisImgURL = data["images"][thisImage].imgURL;
                            thisCaption = data["images"][thisImage].caption;

                            //display the image
                            htmlString += "<div class='imgBlob'> <img src= 'images/" + thisImgURL + "' alt= '" + thisCaption + "' width='500' >";

                            //write caption
                            htmlString += "<p class='caption'>" + thisCaption + "</p></div>";
                        
                        }
                    }
                    */
                    htmlString += "</div>";
                }

                //put all posts into the feed
                document.getElementById('feed').innerHTML = htmlString;
            })()
            
        }


        function loadTestPost(){
            
            /* Test Blog Post info */
            var thisTitle = "Test Post";
            var thisDate = "January 6, 2023";
            var thisContent = "<p>Hi. This is what the post will like like when I have put it in the JSON file. <img src='/images/wiggum.png'></p>";
            htmlString = "";

            //create div
            //htmlString += "<div class='postBox' onclick='openPage("+'"'+thisPost+'"'+")'>";
            htmlString += "<div class='postBox'>";
                    
            //title and date
            htmlString += "<h2 class='title'>" + thisTitle + "</h2>";
            htmlString += "<h3 class='date'>" + thisDate +"</h3>";
                    
            //content
            htmlString += "<div class='content'><p>" + thisContent + "</p></div>";
        
            //put all posts into the feed
            document.getElementById('feed').innerHTML = htmlString;
        }
        
        function openPage(param) {
            var url = 'blogPost.html?postID=' + encodeURIComponent(param);
            window.open(url, '_self');
        }
        
        
        
        function goHome(){
            open("blogHome.html","_self");
        }
    </script>

</html>